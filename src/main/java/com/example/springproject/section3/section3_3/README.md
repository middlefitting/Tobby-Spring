# 3.3 JDBC 전략 패턴의 최적화

### DAO 중심 전략 패턴 구성 요소 정리
- 전략: PreparedStatement
- 클라이언트: DAO 메소드
- 컨텍스트: PreparedStatement 를 실행하는 JDBC 작업 흐름

### 전략과 클라이언트의 동거 문제점
1. DAO 메소드마다 StatementStrategy 구현 클래스를 만들어야 한다.
    - 런타임 다이내믹 DI 제외하면 템플릿 콜백과 다를바가 없다.
2. 부가 정보가 있으면 생성자와 인스턴스 변수를 만들어야 한다.

### 로컬 클래스
- 전략 클래스를 내부 클래스로 정의한다.
    - 특정 메소드에서만 사용되는 것이라면 로컬 클래스를 고려할 수 있다.
        - 로컬 클래스: 메소드 내부
        - 멤버 클래스: 인스턴스 멤버 클래스, 정적 멤버 클래스
        - 익명 클래스
- 내부 클래스는 선언된 곳의 정보를 접근할 수 있다 == 내부 메소드는 정의된 메소드의 로컬 변수에 직접 접근 가능
    - 자바 7까지는 내부 클래스에서 외부 변수를 사용할 때는 final 로 선언해야 한다.
- 외부 변수를 사용할 수 있는 것은 variable capture 를 통해 복사 
    - 이런 기능을 클로저라고 한다. 
    - 값을 바꾸게 되면 생명주기로 인해 문제가 생긴다(스택, 힙). 그래서 허용되지 않음

### Effectively Final
- 외부 지역 변수가 변경되지 않는다면 final 로 취급

### 익명 내부 클래스
- 선언과 동시에 오브젝트를 생성
- 자신의 타입을 가질 수 없고 인터페이스 타입의 변수에만 저장 가능
